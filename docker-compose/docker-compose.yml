version: "3"

# Use docker-compose as the working directory while using this file!

services:
  lowkey-vault:
    container_name: docker-compose-lowkey-vault
    image: nagyesta/lowkey-vault:1.11.0@sha256:2262c3bbef13cfe0d1b4e89156c7206f1fe742046ee619ec32b21a242a50a57b
    ports:
      - "8443:8443"
    volumes:
      - key-import:/import/:ro
    environment:
      # Set arguments for Lowkey Vault configuring key parameters, such as:
      # - setting the port we want to use: --server.port=8443
      # - disable automatic vault creation: --LOWKEY_VAULT_NAMES=-
      # - turn off debug option controlling request logging: --LOWKEY_DEBUG_REQUEST_LOG=false
      # - specify the name of the import file: --LOWKEY_IMPORT_LOCATION=/import/keyvault.json.hbs
      # - defining the value of {{host}} placeholders in the import: --LOWKEY_IMPORT_TEMPLATE_HOST=localhost
      # - defining the value of {{port}} placeholders in the import: --LOWKEY_IMPORT_TEMPLATE_PORT=8443
      # More details at: https://github.com/nagyesta/lowkey-vault/tree/main/lowkey-vault-app#startup-parameters
      LOWKEY_ARGS: "--server.port=8443 --LOWKEY_VAULT_NAMES=- --LOWKEY_DEBUG_REQUEST_LOG=false --LOWKEY_IMPORT_LOCATION=/import/keyvault.json.hbs --LOWKEY_IMPORT_TEMPLATE_HOST=localhost --LOWKEY_IMPORT_TEMPLATE_PORT=8443"
volumes:
  # Create a volume, allowing us to share the backup file with the container by mounting it
  key-import:
    driver: local
    driver_opts:
      type: "none"
      o: "bind"
      # set the current directory as volume root
      device: "$PWD/"
